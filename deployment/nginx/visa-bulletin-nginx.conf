# Base Nginx configuration for Visa Bulletin Dashboard
# 
# This file contains the base HTTP configuration.
# SSL/HTTPS configuration is managed by Certbot and added automatically during deployment.
# 
# The deployment script (scripts/deploy.sh) copies this base config and then runs
# Certbot to add SSL on top, ensuring SSL is always configured correctly.

server {
    listen 80;
    server_name visa-bulletin.us www.visa-bulletin.us;

    location = /favicon.ico { 
        access_log off; 
        log_not_found off; 
    }
    
    location /static/ {
        alias /opt/visa_bulletin/webapp/static/;
        expires 30d;
        add_header Cache-Control "public, no-transform";
        access_log off;
    }

    # Cache static assets (CSS, JS, fonts) from CDNs
    # These are immutable versioned files
    location ~* \.(css|js|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Cache HTML for 3 hours (matching Django cache)
        add_header Cache-Control "public, max-age=10800";
    }
}

# SSL Configuration (managed by Certbot)
# Certbot adds a separate server block for HTTPS (port 443) with SSL certificates.
# This is handled automatically by the deployment script.
